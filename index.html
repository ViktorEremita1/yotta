<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#9333ea">
  <meta name="description" content="Приложение для подсчета очков в игре Ётта">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Ётта">
  <title>Ётта - Счётчик очков</title>
  
  <!-- Manifest -->
  <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogItCB0YLRgtCwIC0g0KHRh9GR0YLRh9C40Log0L7Rh9C60L7QsiIsCiAgInNob3J0X25hbWUiOiAi0IHRgtGC0LAiLAogICJkZXNjcmlwdGlvbiI6ICLQn9GA0LjQu9C+0LbQtdC90LjQtSDQtNC70Y8g0L/QvtC00YHRh9GR0YLQsCDQvtGH0LrQvtCyINCyINC40LPRgNC1INCR0YLRgtCwIiwKICAic3RhcnRfdXJsIjogIi8iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiNmZmZmZmYiLAogICJ0aGVtZV9jb2xvciI6ICIjOTMzM2VhIiwKICAib3JpZW50YXRpb24iOiAicG9ydHJhaXQiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSXhPVElpSUdobGFXZG9kRDBpTVRreUlqNDhjbVZqZENCM2FXUjBhRDBpTVRreUlpQm9aV2xuYUhROUlqRTVNaUlnWm1sc2JEMGlJemt6TXpObFlTSXZQanh3WVhSb0lHUTlJazB4TURBZ056SmpNQ0F0TVRVdU5DMHhNaTQySXkweU9DMHlPQ0F0TWpnaU1DQXdJREl6SURFd01DQXhNREF6TUNCeklESXlMalVnTVRJdU5pQXlPQ0F5T0NBeU9DSWdabWxzYkQwaUkzZG1abVptWmlJdlBqeDBaWGgwSUhnOUlqRXdNQ0lnZVQwaU1UQXdJaUJtYjI1MExXWmhiV2xzZVQwaVFYSnBZV3dpSUdadmJuUXRjMmw2WlQwaU5qUWlJR1pwYkd3OUlpTTVNek16WldFaUlIUmxlSFF0WVc1amFHOXlQU0p0YVdSa2JHVWlQbGdpTHoxK1BDOXpkbWMrIiwKICAgICAgInNpemVzIjogIjE5MngxOTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfSwKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSTFNVElpSUdobGFXZG9kRDBpTlRFeUlqNDhjbVZqZENCM2FXUjBhRDBpTlRFeUlpQm9aV2xuYUhROUlqVXhNaUlnWm1sc2JEMGlJemt6TXpObFlTSXZQanh3WVhSb0lHUTlJazB5TlRZZ01UazBZekFnTFRRd0xqUXRNek11TmlBdE56TXROelFnTFRjeklEQWdNQ0EyTWlBeU5UWWdNalUySURJMU5pQXpNVEFnTUNBMk1pNDJJRE16TGpZZ056UWdOelFpTUNBd0lEWXhMVEkxTmlBeU5UWXRNVEV3SURBdE5EVXVOeTB6TXk0MkxUYzBMVGMwZWlJZ1ptbHNiRDBpSTNkbVptWm1aaUl2UGp4MFpYaDBJSGc5SWpJMU5pSWdlVDBpTWpVMklpQm1iMjUwTFdaaGJXbHNlVDBpUVhKcFlXd2lJR1p2Ym5RdGMybDZaVDBpTVRZd0lpQm1hV3hzUFNJak9UTXpNMlZoSWlCMFpYaDBMV0Z1WTJodmNqMGliV2xrWkd4bElqNVlQQzlqUG04OEwzUmxlSFErUEM5emRtYysiLAogICAgICAic2l6ZXMiOiAiNTEyeDUxMiIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICB9CiAgXQp9">
  
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow: hidden;
      position: fixed;
      width: 100%;
      height: 100%;
    }
    
    #root {
      width: 100%;
      height: 100%;
    }
    
    /* Prevent pull-to-refresh */
    body {
      overscroll-behavior-y: contain;
    }
    
    /* iOS status bar spacing */
    @supports (padding: max(0px)) {
      body {
        padding-top: max(0px, env(safe-area-inset-top));
        padding-bottom: max(0px, env(safe-area-inset-bottom));
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;
    
    // Lucide Icons
    const Trophy = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path>
        <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path>
        <path d="M4 22h16"></path>
        <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path>
        <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path>
        <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path>
      </svg>
    );
    
    const Delete = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="M21 4H8l-7 8 7 8h13a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z"></path>
        <line x1="18" y1="9" x2="12" y2="15"></line>
        <line x1="12" y1="9" x2="18" y2="15"></line>
      </svg>
    );
    
    const Check = ({ size = 24, className = "" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    );

    const YottaScoreApp = () => {
      const [screen, setScreen] = useState('welcome');
      const [playerCount, setPlayerCount] = useState(0);
      const [playerNames, setPlayerNames] = useState(['', '', '', '']);
      const [currentNameIndex, setCurrentNameIndex] = useState(0);
      const [players, setPlayers] = useState([]);
      const [currentPlayerIndex, setCurrentPlayerIndex] = useState(0);
      const [inputValue, setInputValue] = useState('');
      const [editingPlayer, setEditingPlayer] = useState(null);

      const startGame = () => {
        setScreen('selectPlayers');
      };

      const selectPlayerCount = (count) => {
        setPlayerCount(count);
        setCurrentNameIndex(0);
        setPlayerNames(['', '', '', '']);
        setScreen('enterNames');
      };

      const handleNameChange = (value) => {
        const newNames = [...playerNames];
        newNames[currentNameIndex] = value;
        setPlayerNames(newNames);
      };

      const nextName = () => {
        if (currentNameIndex < playerCount - 1) {
          setCurrentNameIndex(currentNameIndex + 1);
        } else {
          const activePlayers = playerNames.slice(0, playerCount).map((name, idx) => ({
            name: name || `Игрок ${idx + 1}`,
            lastScore: 0,
            totalScore: 0,
            scores: []
          }));
          setPlayers(activePlayers);
          setScreen('confirmNames');
        }
      };

      const startScoring = () => {
        setScreen('game');
      };

      const handleNumberClick = (num) => {
        setInputValue(prev => prev + num);
      };

      const handleDelete = () => {
        setInputValue(prev => prev.slice(0, -1));
      };

      const handleConfirm = () => {
        if (inputValue === '') return;

        const score = parseInt(inputValue);

        if (editingPlayer !== null) {
          const newPlayers = [...players];
          const scoreIndex = newPlayers[editingPlayer].scores.length - 1;
          newPlayers[editingPlayer].scores[scoreIndex] = score;
          newPlayers[editingPlayer].lastScore = score;
          newPlayers[editingPlayer].totalScore = newPlayers[editingPlayer].scores.reduce((a, b) => a + b, 0);
          setPlayers(newPlayers);
          setEditingPlayer(null);
        } else {
          const newPlayers = [...players];
          newPlayers[currentPlayerIndex].scores.push(score);
          newPlayers[currentPlayerIndex].lastScore = score;
          newPlayers[currentPlayerIndex].totalScore += score;
          setPlayers(newPlayers);
          setCurrentPlayerIndex((currentPlayerIndex + 1) % playerCount);
        }

        setInputValue('');
      };

      const handleCellClick = (playerIndex) => {
        if (players[playerIndex].scores.length > 0) {
          setEditingPlayer(playerIndex);
          setInputValue(players[playerIndex].lastScore.toString());
        }
      };

      const endGame = () => {
        setScreen('results');
      };

      const restartGame = () => {
        setScreen('welcome');
        setPlayerCount(0);
        setPlayerNames(['', '', '', '']);
        setCurrentNameIndex(0);
        setPlayers([]);
        setCurrentPlayerIndex(0);
        setInputValue('');
        setEditingPlayer(null);
      };

      const sortedPlayers = [...players].sort((a, b) => b.totalScore - a.totalScore);

      return (
        <div className="min-h-screen bg-gradient-to-br from-purple-600 via-pink-500 to-orange-400 flex items-center justify-center p-4">
          <div className="w-full max-w-md bg-white rounded-3xl shadow-2xl overflow-hidden">
            
            {screen === 'welcome' && (
              <div className="p-12 text-center">
                <h1 className="text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-600 mb-4">
                  Ётта
                </h1>
                <p className="text-xl text-gray-600 mb-12">Считать просто</p>
                <button
                  onClick={startGame}
                  className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-2xl text-xl font-semibold hover:shadow-lg transition-all transform hover:scale-105"
                >
                  Начать
                </button>
              </div>
            )}

            {screen === 'selectPlayers' && (
              <div className="p-12 text-center">
                <h2 className="text-3xl font-bold text-gray-800 mb-8">
                  Сколько человек играет?
                </h2>
                <div className="space-y-4">
                  {[2, 3, 4].map(count => (
                    <button
                      key={count}
                      onClick={() => selectPlayerCount(count)}
                      className="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white py-4 rounded-2xl text-2xl font-semibold hover:shadow-lg transition-all transform hover:scale-105"
                    >
                      {count}
                    </button>
                  ))}
                </div>
              </div>
            )}

            {screen === 'enterNames' && (
              <div className="p-12">
                <h2 className="text-2xl font-bold text-gray-800 mb-2 text-center">
                  Игрок {currentNameIndex + 1} из {playerCount}
                </h2>
                <p className="text-gray-600 mb-6 text-center">Введите имя</p>
                <input
                  type="text"
                  value={playerNames[currentNameIndex]}
                  onChange={(e) => handleNameChange(e.target.value)}
                  className="w-full p-4 border-2 border-purple-300 rounded-xl mb-6 text-lg focus:outline-none focus:border-purple-500"
                  placeholder="Имя игрока"
                  autoFocus
                />
                <button
                  onClick={nextName}
                  className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-2xl text-xl font-semibold hover:shadow-lg transition-all"
                >
                  {currentNameIndex < playerCount - 1 ? 'Далее' : 'Готово'}
                </button>
              </div>
            )}

            {screen === 'confirmNames' && (
              <div className="p-12">
                <h2 className="text-3xl font-bold text-gray-800 mb-6 text-center">
                  Игроки
                </h2>
                <div className="space-y-3 mb-8">
                  {players.map((player, idx) => (
                    <div key={idx} className="bg-gradient-to-r from-purple-100 to-pink-100 p-4 rounded-xl text-center">
                      <span className="text-xl font-semibold text-gray-800">{player.name}</span>
                    </div>
                  ))}
                </div>
                <button
                  onClick={startScoring}
                  className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-2xl text-xl font-semibold hover:shadow-lg transition-all"
                >
                  Начать
                </button>
              </div>
            )}

            {screen === 'game' && (
              <div className="flex flex-col h-screen max-h-[800px]">
                <div className="bg-gradient-to-r from-purple-600 to-pink-600 p-3 flex justify-between items-center">
                  <h2 className="text-xl font-bold text-white">Ётта</h2>
                  <button
                    onClick={endGame}
                    className="bg-white text-purple-600 px-3 py-1.5 rounded-lg font-semibold hover:shadow-lg transition-all text-sm"
                  >
                    Закончить игру
                  </button>
                </div>

                <div className="flex-1 bg-gray-50 p-3">
                  <table className="w-full">
                    <thead>
                      <tr className="border-b-2 border-gray-300">
                        <th className="text-left py-2 px-2 text-gray-700 font-semibold text-sm">Имя</th>
                        <th className="text-center py-2 px-2 text-gray-700 font-semibold text-sm">Ход</th>
                        <th className="text-center py-2 px-2 text-gray-700 font-semibold text-sm">Всего</th>
                      </tr>
                    </thead>
                    <tbody>
                      {players.map((player, idx) => (
                        <tr 
                          key={idx} 
                          className={`border-b border-gray-200 ${
                            idx === currentPlayerIndex && editingPlayer === null
                              ? 'bg-purple-100' 
                              : editingPlayer === idx
                              ? 'bg-yellow-100'
                              : ''
                          }`}
                        >
                          <td className="py-2.5 px-2 font-medium text-gray-800 text-sm">{player.name}</td>
                          <td 
                            className="py-2.5 px-2 text-center text-base font-semibold text-purple-600 cursor-pointer hover:bg-purple-50 active:bg-purple-100"
                            onClick={() => handleCellClick(idx)}
                          >
                            {player.lastScore || '-'}
                          </td>
                          <td className="py-2.5 px-2 text-center text-lg font-bold text-gray-800">
                            {player.totalScore}
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>

                  <div className="mt-3 text-center">
                    <div className="text-xs text-gray-600 mb-1.5">
                      {editingPlayer !== null 
                        ? `Редактирование: ${players[editingPlayer].name}` 
                        : `Сейчас ходит: ${players[currentPlayerIndex].name}`}
                    </div>
                    <div className="bg-white rounded-lg p-2 shadow-md">
                      <div className="text-2xl font-bold text-gray-800">
                        {inputValue || '0'}
                      </div>
                    </div>
                  </div>
                </div>

                <div className="bg-gradient-to-br from-purple-50 to-pink-50 p-2 pb-3 border-t-2 border-gray-200">
                  <div className="grid grid-cols-3 gap-1.5 max-w-[280px] mx-auto">
                    {[1, 2, 3, 4, 5, 6, 7, 8, 9].map(num => (
                      <button
                        key={num}
                        onClick={() => handleNumberClick(num.toString())}
                        className="bg-white hover:bg-purple-100 text-gray-800 text-base font-semibold py-2 rounded-lg shadow-md transition-all active:scale-95"
                      >
                        {num}
                      </button>
                    ))}
                    <button
                      onClick={handleDelete}
                      className="bg-red-500 hover:bg-red-600 text-white py-2 rounded-lg shadow-md transition-all active:scale-95 flex items-center justify-center"
                    >
                      <Delete size={16} />
                    </button>
                    <button
                      onClick={() => handleNumberClick('0')}
                      className="bg-white hover:bg-purple-100 text-gray-800 text-base font-semibold py-2 rounded-lg shadow-md transition-all active:scale-95"
                    >
                      0
                    </button>
                    <button
                      onClick={handleConfirm}
                      className="bg-green-500 hover:bg-green-600 text-white py-2 rounded-lg shadow-md transition-all active:scale-95 flex items-center justify-center"
                    >
                      <Check size={16} />
                    </button>
                  </div>
                </div>
              </div>
            )}

            {screen === 'results' && (
              <div className="p-12">
                <h2 className="text-3xl font-bold text-center mb-8 text-gray-800">
                  Результаты игры
                </h2>
                <div className="space-y-4 mb-8">
                  {sortedPlayers.map((player, idx) => (
                    <div
                      key={idx}
                      className={`p-4 rounded-xl flex justify-between items-center ${
                        idx === 0
                          ? 'bg-gradient-to-r from-yellow-400 to-orange-400 shadow-lg'
                          : 'bg-gradient-to-r from-purple-100 to-pink-100'
                      }`}
                    >
                      <div className="flex items-center gap-3">
                        {idx === 0 && <Trophy size={32} className="text-white" />}
                        <span className={`text-xl font-bold ${idx === 0 ? 'text-white' : 'text-gray-800'}`}>
                          {idx + 1}. {player.name}
                        </span>
                      </div>
                      <span className={`text-2xl font-bold ${idx === 0 ? 'text-white' : 'text-purple-600'}`}>
                        {player.totalScore}
                      </span>
                    </div>
                  ))}
                </div>
                <button
                  onClick={restartGame}
                  className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-2xl text-xl font-semibold hover:shadow-lg transition-all"
                >
                  Новая игра
                </button>
              </div>
            )}
          </div>
        </div>
      );
    };

    ReactDOM.render(<YottaScoreApp />, document.getElementById('root'));
  </script>

  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        // Service Worker code inline
        const swCode = `
          const CACHE_NAME = 'yotta-v1';
          const urlsToCache = ['/'];

          self.addEventListener('install', event => {
            event.waitUntil(
              caches.open(CACHE_NAME)
                .then(cache => cache.addAll(urlsToCache))
            );
          });

          self.addEventListener('fetch', event => {
            event.respondWith(
              caches.match(event.request)
                .then(response => response || fetch(event.request))
            );
          });
        `;
        
        const blob = new Blob([swCode], { type: 'application/javascript' });
        const swUrl = URL.createObjectURL(blob);
        
        navigator.serviceWorker.register(swUrl)
          .then(registration => {
            console.log('ServiceWorker registered:', registration);
          })
          .catch(error => {
            console.log('ServiceWorker registration failed:', error);
          });
      });
    }

    // Install prompt
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      console.log('PWA install prompt available');
    });
  </script>
</body>
</html>
